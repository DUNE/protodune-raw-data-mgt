digraph pdrnotifier {
	label="Bespoked Design";
	rankdir=LR;
	
	processes[label="Process"];
	file[label="File or\nnetwork",shape=box];
	server[label="Server",shape=octagon];


	daq1[label="DAQ EB1"];
	daq2[label="DAQ EB2"];
	daqn[label="DAQ EBN"];
	

	fifo[shape=box,label="FIFO",color=red];
	
	xrootdrdr[shape=octagon,label="XRootD\nredirector",color=red]
	xrootd[shape=octagon,label="XRootD\nserver N",color=red]
	eos[shape=octagon,label="EOS"]

	fts[shape=octagon,label="F-FTS",color="blue"];
	sam[shape=octagon,label="SAM",color="orange"];
	http[shape=box,label="HTTP POST"];
	
	exec[shape=octagon,label="Process\nDispatcher",color="purple"];
	handler[label="Handler",color="purple"];
	notifier[label="Notifier",color="purple"];
	recovery[label="Recovery",color="purple"];
	metafilebuilder[label="Metadata\nFile Producer",style=dashed,color="purple"];
	db[shape=box, label="DB"];

	{rank="same"; handler; notifier; recovery; }

	{rank="same"; xrootdrdr; xrootd; eos}
	{rank="same"; fts; sam; fifo; http}



	

	daq1->xrootdrdr[style=dashed];
	
	xrootdrdr->xrootd[style=dashed];

	daq1->xrootd[label="TFile::Open()"];
	daq2->xrootd[label="xrdcp"];
	daqn->xrootd[label="..."];
	xrootd->fifo[label="file state"];
	fifo->handler[label="read()"];
	handler->db[label="record"];
	handler->fifo[label="poll()"];
	handler->exec[label="forward"];
	exec->notifier[label="forward"];
	notifier->http;
	http->fts[label="Xrootd URL"];
	notifier->db;
	recovery->db[label="query"];
	db->recovery[label="orphaned"];
	recovery->exec[label="replay"];
	recovery->sam[label="query"];
	sam->recovery[label="missing"];
	exec->metafilebuilder->db;
	metafilebuilder->exec;
	fts->xrootdrdr[label="xrdcp --tpc"];
	fts->sam[label="update"];
	
	xrootd->eos[label="transfer"];
}
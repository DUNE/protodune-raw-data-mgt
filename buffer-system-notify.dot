digraph pdrnotifier {
	label="Mediated Notify with Optional Metadata Producer Design";
	rankdir=LR;
	
	processes[label="Process"];
	file[label="File or\nnetwork",shape=box];
	server[label="Server",shape=octagon];


	daq1[label="DAQ EB1"];
	daq2[label="DAQ EB2"];
	daqn[label="DAQ EBN"];
	

	fifo[shape=box,label="FIFO",color=red];
	notifier[label="Notifier",color="purple"];
	mdfp[label="Metadata\nfile producer",color="purple"];
	
	xrootdrdr[shape=octagon,label="XRootD\nredirector",color=red]
	xrootd[shape=octagon,label="XRootD\nserver N",color=red]
	eos[shape=octagon,label="EOS"]

	db[shape=box, label="DB"];

	fts[shape=octagon,label="F-FTS",color="blue"];
	sam[shape=octagon,label="SAM",color="orange"];

	{rank="same"; xrootdrdr; xrootd; eos}
	{rank="same"; notifier; mdfp}
	

	daq1->xrootdrdr[style=dashed];
	xrootdrdr->xrootd[style=dashed];

	daq1->xrootd[label="TFile::Open()"];
	daq2->xrootd[label="xrdcp"];
	daqn->xrootd[label="..."];

	xrootd->fifo[label="file state"];
	fifo->notifier[label="select()/poll()"];
	notifier->fts[label="HTTP POST"];
	notifier->mdfp->notifier[style=dashed];
	notifier->xrootdrdr[style=dashed,label="metadata file"];
	notifier->db[label="monitoring"];

	fts->xrootdrdr[label="xrdcp --tpc"];
	fts->sam[label="update"];
	
	xrootd->eos[label="transfer"];
}